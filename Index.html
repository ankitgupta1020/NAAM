<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Radha Naam Jaap Counter ‚Äî ‡§§‡•á‡§ú‡§º, ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤-‡§´‡•ç‡§∞‡•á‡§Ç‡§°‡§≤‡•Ä | NaamJaa</title>
    <meta name="description" content="Radha Naam Jaap counter ‚Äî Tap anywhere to add 1 mantra, track rounds (108), create profile, view daily history & weekly leaderboard. Fast, offline friendly." />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <link rel="canonical" href="https://naamjaa.netlify.app/radha-jaap/" />
    <meta name="robots" content="index, follow" />
    <link rel="sitemap" href="/sitemap.xml" />

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Radha Naam Jaap Counter ‚Äî NaamJaa">
    <meta property="og:description" content="Tap anywhere to count mantras. Track 108, create profile, view history & leaderboard. Mobile friendly and offline capable.">
    <meta property="og:url" content="https://naamjaa.netlify.app/radha-jaap/">
    <meta property="og:image" content="https://naamjaa.netlify.app/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <link rel="image_src" href="https://naamjaa.netlify.app/og-image.png" />
    <meta property="og:image:secure_url" content="https://naamjaa.netlify.app/og-image.png" />
    <meta property="og:image:alt" content="NaamJaa ‚Äî Radha Naam Jaap Counter, mobile-friendly jaap counter" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="https://naamjaa.netlify.app/og-image.png" />

    <!-- fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700;900&family=Noto+Sans+Devanagari:wght@400;700&family=Poppins:wght@500;700&display=swap" rel="stylesheet">

    <!-- dataLayer helper -->
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtmEvent(name, params = {}) {
        try { window.dataLayer.push(Object.assign({ event: name }, params)); } catch(e){}
      }
    </script>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PS452RRD');</script>
    <!-- End Google Tag Manager -->

    <style>
      :root{
        --bg1:#fff3b0; --bg2:#f3722c; --accent:#f94144; --muted:#2d1b00;
        --card: rgba(255,255,255,0.14); --glass-border: rgba(255,255,255,0.2);
        --glass-text: #fffaf0;
        --shadow: 0 12px 32px rgba(0,0,0,0.18);
        --pad:16px;
        --safe-top: max(var(--pad), env(safe-area-inset-top));
        --safe-right: max(var(--pad), env(safe-area-inset-right));
        --safe-bottom: max(var(--pad), env(safe-area-inset-bottom));
        --safe-left: max(var(--pad), env(safe-area-inset-left));
      }
      *{box-sizing:border-box}
      html,body{height:100%;margin:0;font-family:'Poppins',system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
      body{
        background: radial-gradient(1200px 600px at 10% 10%, rgba(249,199,59,0.12), transparent 10%),
                    radial-gradient(800px 400px at 90% 90%, rgba(249,65,68,0.08), transparent 10%),
                    linear-gradient(180deg, var(--bg1), var(--bg2));
        color:var(--muted);
        -webkit-font-smoothing:antialiased;
        -moz-osx-font-smoothing:grayscale;
        -webkit-tap-highlight-color: transparent;
      }

      /* layout */
      .app{min-height:100dvh;padding:calc(var(--safe-top) + 10px) calc(var(--safe-right) + 10px) calc(var(--safe-bottom) + 10px) calc(var(--safe-left) + 10px); display:flex;align-items:center;justify-content:center}
      .container{width:100%;max-width:980px;margin:0 auto;display:grid;grid-template-columns: 1fr;gap:18px;align-items:start}

      /* header / hero */
      header.hero{display:flex;gap:16px;align-items:center;justify-content:center;flex-direction:column;text-align:center;padding:18px}
      .logo { display:flex; align-items:center; gap:12px; }
      .logo svg{width:44px;height:44px}
      .site-title{font-family:'Merriweather', 'Noto Sans Devanagari', serif;font-size: clamp(20px, 3.8vw, 34px); color:var(--accent); font-weight:900; letter-spacing:0.6px}
      .tagline{font-family:'Noto Sans Devanagari','Poppins'; color:var(--glass-text); margin-top:6px; font-size:clamp(14px,2.8vw,18px)}
      .hero-cta{margin-top:12px;padding:12px 20px;border-radius:14px;background:#fff;color:var(--muted);font-weight:800;box-shadow:var(--shadow);text-decoration:none;display:inline-flex;gap:10px;align-items:center}
      .hero-cta .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(45deg,#f8961e,#f94144);box-shadow:0 4px 16px rgba(249,65,68,0.28)}

      /* layout grid for main content */
      .grid{display:grid;grid-template-columns: 1fr 360px; gap:18px}
      @media (max-width:900px){ .grid{grid-template-columns:1fr} .container{padding:0 12px} }

      /* card */
      .card{background:var(--card);backdrop-filter: blur(10px);border-radius:16px;padding:14px;border:1px solid var(--glass-border); box-shadow:var(--shadow); color:var(--glass-text)}

      /* counter area */
      .counter-area{display:flex;flex-direction:column;align-items:center;gap:12px;padding:18px}
      .ring-viewport{width: min(380px, 84vw); aspect-ratio:1/1; display:grid;place-items:center; position:relative}
      svg.ring{width:100%;height:100%;display:block}
      .center-count{position:absolute;display:flex;flex-direction:column;align-items:center;justify-content:center;pointer-events:none}
      .center-count .bead{font-size:clamp(22px,6.5vw,44px);font-weight:800;color:#fff7e0; text-shadow:0 6px 20px rgba(0,0,0,0.25)}
      .center-count .rounds{font-size:14px;color:rgba(255,255,255,0.85);margin-top:6px}

      /* beads - small label under ring for accessibility */
      .ring-legend{margin-top:6px;font-size:13px;color:rgba(255,255,255,0.92)}

      /* controls */
      .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px}
      .btn{background:#fff;border-radius:12px;padding:10px 14px;font-weight:700;border:none;cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,0.12)}
      .btn.secondary{background:rgba(255,255,255,0.12);color:var(--glass-text);border:1px solid rgba(255,255,255,0.06)}

      /* leaderboard */
      .leader{display:flex;flex-direction:column;gap:12px}
      .leader h3{margin:0;font-size:14px;color:var(--glass-text)}
      .leader-list{display:flex;flex-direction:column;gap:8px}
      .leader-row{display:flex;align-items:center;gap:10px;padding:8px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))}
      .avatar{width:40px;height:40px;border-radius:50%;display:grid;place-items:center;font-weight:800;color:#fff}
      .u-name{font-weight:700;color:#fff;margin-right:auto}
      .medal{width:22px;height:22px;display:inline-grid;place-items:center;font-size:12px;margin-right:6px}

      /* table styles for history */
      .table{width:100%;border-collapse:collapse;margin-top:6px;font-size:14px}
      .table th{opacity:0.9;text-align:left;padding:6px}
      .table td{padding:8px 6px;color:rgba(255,255,255,0.95)}
      .small-note{font-size:12px;color:rgba(255,255,255,0.85);margin-top:8px}

      /* UPI FAB */
      .upi-fab{position:fixed;right:18px;bottom:calc(18px + env(safe-area-inset-bottom));z-index:999;background:#fff;border-radius:999px;padding:12px 14px;display:inline-flex;align-items:center;gap:8px;font-weight:800;box-shadow:0 18px 36px rgba(0,0,0,0.22);cursor:pointer;transform-origin:center;animation:fab-pulse 2.8s infinite}
      @keyframes fab-pulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}
      .upi-fab .heart{font-size:16px;color:#e11d48}

      /* share row */
      .share-row{display:flex;gap:8px;justify-content:center;margin-top:8px}
      .share-btn{background:rgba(255,255,255,0.12);border-radius:10px;padding:8px 10px;color:#fff;font-weight:700;border:none;cursor:pointer}

      /* small animations */
      .bead-on{fill:#fff2d9; stroke:#f94144; r:6; transition: r .12s ease, fill .18s ease, stroke .18s ease }
      .bead-off{fill: rgba(255,255,255,0.08); transition: fill .18s ease }

      /* accessible hidden */
      .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
    </style>
  </head>

  <body>
    <!-- GTM noscript -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PS452RRD" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <div class="app" id="app-root">
      <div class="container">
        <header class="hero" role="banner">
          <div class="logo" aria-hidden="true">
            <!-- small decorative icon -->
            <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="32" cy="32" r="30" fill="#fff7e0"/><path d="M32 12c8 0 14 6 14 14s-6 14-14 14-14-6-14-14S24 12 32 12z" fill="#f8961e"/></svg>
            <div>
              <div class="site-title">NaamJaa</div>
              <div style="font-size:12px;color:rgba(45,27,0,0.6)">Radha Naam Jaap Counter</div>
            </div>
          </div>

          <div style="max-width:780px">
            <div class="tagline">‡§∞‡§æ‡§ß‡§æ ‡§ï‡•á ‡§®‡§æ‡§Æ ‡§ï‡§æ ‡§∏‡§∞‡§≤ ‡§ú‡§æ‡§™ ‚Äî ‡§ï‡§π‡•Ä‡§Ç ‡§≠‡•Ä ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç, ‡§ó‡§ø‡§®‡§§‡•Ä ‡§Ö‡§™‡§®‡•á ‡§Ü‡§™ ‡§¨‡§¢‡§º‡•á‡§ó‡•Ä‡•§</div>
            <a href="#root" class="hero-cta" id="start-cta" onclick="document.getElementById('app-root').scrollIntoView({behavior:'smooth'});">
              <span class="dot" aria-hidden="true"></span> Start Jaap
            </a>
          </div>
        </header>

        <main class="grid" id="root" role="main" aria-label="Radha Jaap Counter App">
          <!-- LEFT: Counter -->
          <section class="card counter-area" aria-labelledby="counter-heading" role="region">
            <h2 id="counter-heading" class="visually-hidden">Radha Jaap Counter</h2>

            <div class="ring-viewport" id="ring-viewport" aria-hidden="false">
              <!-- SVG ring + dynamic beads rendered by JS -->
              <svg class="ring" viewBox="0 0 420 420" role="img" aria-label="108 bead ring">
                <!-- background ring -->
                <defs>
                  <linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#f8961e"/><stop offset="1" stop-color="#f94144"/></linearGradient>
                </defs>
                <circle cx="210" cy="210" r="150" stroke="rgba(255,255,255,0.14)" stroke-width="30" fill="none" />
                <g id="beads"></g>
                <circle cx="210" cy="210" r="100" fill="rgba(0,0,0,0.06)"/>
              </svg>

              <div class="center-count" aria-live="polite">
                <div class="bead" id="center-bead">0 / 108</div>
                <div class="rounds" id="center-rounds">Mala: 0 ‚Ä¢ Naam: 0</div>
                <div style="margin-top:8px">
                  <button class="btn" id="tap-here" aria-label="Tap anywhere to add one mantra">Tap ‚Ä¢ +1</button>
                </div>
              </div>
            </div>

            <div class="ring-legend">Tap / Click anywhere on the ring to add a mantra ‚Ä¢ Space/Enter = +1</div>

            <div class="controls" role="group" aria-label="controls">
              <button class="btn secondary" id="btn-decrement">-1</button>
              <button class="btn secondary" id="btn-reset108">Reset to multiple of 108</button>
              <button class="btn secondary" id="btn-reset-user">Reset User</button>
            </div>

            <div class="share-row" aria-hidden="false">
              <button class="share-btn" id="share-web" title="Share">Share</button>
              <button class="share-btn" id="share-whatsapp" title="Share on WhatsApp">WhatsApp</button>
            </div>

            <div class="small-note">Data stored locally on this device. Profiles are device-specific.</div>
          </section>

          <!-- RIGHT: Profile / Leaderboard -->
          <aside>
            <div class="card" style="margin-bottom:12px">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <strong style="font-size:14px">Profile</strong>
                <span class="pill" style="background:transparent;color:rgba(255,255,255,0.8);font-weight:700">Device only</span>
              </div>

              <div id="profile-area" style="margin-top:10px">
                <!-- form -->
                <div id="profile-form" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
                  <input id="p-name" class="input" placeholder="Name" style="padding:8px;border-radius:10px;border:none;width:calc(100% - 120px);min-width:120px" />
                  <input id="p-city" class="input" placeholder="City" style="padding:8px;border-radius:10px;border:none;width:100px" />
                  <button class="btn" id="btn-create">Create</button>
                </div>
              </div>
            </div>

            <div class="card leader">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <h3>Weekly Leaderboard</h3>
                <div style="font-size:12px;color:rgba(255,255,255,0.85)"><span id="wkkey">‚Äî</span></div>
              </div>
              <div class="leader-list" id="leader-list" style="margin-top:10px">
                <!-- dynamic rows -->
              </div>
              <div class="small-note">Leaderboard is stored on this device only.</div>
            </div>

            <div class="card" style="margin-top:12px">
              <strong style="display:block;margin-bottom:8px">Last 14 days</strong>
              <div id="history-area" style="min-height:40px">No history yet ‚Äî tap to begin.</div>
            </div>
          </aside>
        </main>

        <footer style="text-align:center;margin-top:12px;color:rgba(45,27,0,0.6);font-size:13px">
          Made with devotion ‚Ä¢ <a href="/privacy.html" style="color:inherit;text-decoration:underline">Privacy</a>
        </footer>
      </div>
    </div>

    <!-- UPI FAB -->
    <a class="upi-fab" id="upi-btn" href="upi://pay?pa=ankitgupta1181-5@oksbi&pn=Radha%20Jaap%20Counter&tn=Dhanyavaad%20üôè&cu=INR" rel="nofollow" aria-label="Support via UPI" title="Support NaamJaa">
      <span class="heart">‚ù§Ô∏è</span> Support
    </a>

    <!-- App script (improved visuals + events) -->
    <script type="module">
      // Using a small module so we can keep code tidy.
      // Keep your LS key unchanged
      const LS_KEY = "rjc_store_v2";
      const loadStore = () => { try { return JSON.parse(localStorage.getItem(LS_KEY)) ?? {}; } catch { return {}; } };
      const saveStore = (s) => localStorage.setItem(LS_KEY, JSON.stringify(s));

      // helpers
      const fmtDate = d => d.toISOString().slice(0,10);
      function weekKeyOf(date){
        const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        const dayNum = (d.getUTCDay() + 6) % 7; d.setUTCDate(d.getUTCDate() - dayNum + 3);
        const firstThu = new Date(Date.UTC(d.getUTCFullYear(),0,4));
        const wk = 1 + Math.round((d - firstThu) / 604800000);
        const yr = d.getUTCFullYear(); return `${yr}-${String(wk).padStart(2,'0')}`;
      }

      // init store
      let store = loadStore();
      if(!store.users) store.users = {};
      if(!store.activeUserId) store.activeUserId = null;
      saveStore(store);

      // UI refs
      const beadsGroup = document.getElementById('beads');
      const centerBead = document.getElementById('center-bead');
      const centerRounds = document.getElementById('center-rounds');
      const btnTap = document.getElementById('tap-here');
      const btnDec = document.getElementById('btn-decrement');
      const btnReset108 = document.getElementById('btn-reset108');
      const btnResetUser = document.getElementById('btn-reset-user');
      const leaderList = document.getElementById('leader-list');
      const wkkeyEl = document.getElementById('wkkey');
      const historyArea = document.getElementById('history-area');
      const createBtn = document.getElementById('btn-create');
      const nameInput = document.getElementById('p-name');
      const cityInput = document.getElementById('p-city');
      const shareBtn = document.getElementById('share-web');
      const shareWhats = document.getElementById('share-whatsapp');
      const upiBtn = document.getElementById('upi-btn');

      // create 108 bead elements once
      const BEAD_COUNT = 108;
      const cx = 210, cy = 210, rr = 150; // circle radius center and bead radius path
      function createBeads(){
        beadsGroup.innerHTML = '';
        for(let i=0;i<BEAD_COUNT;i++){
          const angle = (i / BEAD_COUNT) * Math.PI * 2 - Math.PI/2; // start at top
          const bx = cx + Math.cos(angle) * rr;
          const by = cy + Math.sin(angle) * rr;
          // small circle
          const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
          c.setAttribute('cx', bx);
          c.setAttribute('cy', by);
          c.setAttribute('r', 6);
          c.setAttribute('class', 'bead-off');
          c.setAttribute('data-index', i+1);
          beadsGroup.appendChild(c);
        }
      }
      createBeads();

      // utility: compute active, update UI
      function getActive(){
        return store.activeUserId ? store.users[store.activeUserId] : null;
      }
      function updateUI(){
        const active = getActive();
        const total = active?.lifetime ?? 0;
        const within = total % BEAD_COUNT;
        const beadNum = within === 0 && total>0 ? BEAD_COUNT : within; // display 108 at completion
        centerBead.textContent = `${beadNum} / ${BEAD_COUNT}`;
        centerRounds.textContent = `Mala: ${Math.floor(total/BEAD_COUNT)} ‚Ä¢ Naam: ${total}`;
        // update beads
        const beadEls = beadsGroup.querySelectorAll('circle');
        beadEls.forEach((el, idx) => {
          const index = idx + 1;
          if(index <= (total % BEAD_COUNT)) {
            el.classList.remove('bead-off'); el.classList.add('bead-on');
            el.setAttribute('r', 7);
          } else {
            el.classList.remove('bead-on'); el.classList.add('bead-off');
            el.setAttribute('r', 6);
          }
        });
        // update leaderboard
        renderLeaderboard();
        // history
        renderHistory();
        // week key
        wkkeyEl.textContent = getActive() ? getActive().weekKey : '‚Äî';
      }

      // spawn burst animation on tap
      function spawnBurst(x,y){
        const layer = document.getElementById('ring-viewport');
        const el = document.createElement('span');
        el.textContent = '‡§∞‡§æ‡§ß‡§æ';
        el.style.position = 'absolute';
        el.style.left = (x - layer.getBoundingClientRect().left)+'px';
        el.style.top = (y - layer.getBoundingClientRect().top)+'px';
        el.style.fontWeight = '900';
        el.style.color = '#fff7e0';
        el.style.pointerEvents = 'none';
        el.style.transform = 'translate(-50%,-50%) scale(.9)';
        el.style.opacity = '1';
        el.style.textShadow = '0 6px 20px rgba(249,65,68,0.26)';
        layer.appendChild(el);
        el.animate([{transform:'translate(-50%,-50%) scale(.9)', opacity:1},{transform:'translate(-50%,-50%) scale(1.2)', opacity:0}], {duration:700, easing:'ease-out'});
        setTimeout(()=>el.remove(),750);
      }

      // update user
      function saveAndSet(s){
        store = s; saveStore(s);
        updateUI();
      }

      function updateUser(uid, mutator){
        const s = {...store, users:{...store.users}};
        const u = s.users[uid]; if(!u) return;
        s.users[uid] = mutator(u);
        saveAndSet(s);
      }

      // increment logic with analytics
      function handleInc(x = window.innerWidth/2, y = window.innerHeight/2){
        const active = getActive();
        if(!active) return alert('Please create a profile first.');
        const predicted = (active.lifetime || 0) + 1;
        updateUser(store.activeUserId, u => {
          const now = new Date(); const wk = weekKeyOf(now); const today = fmtDate(now);
          const dayCounts = {...(u.dayCounts||{})};
          dayCounts[today] = (dayCounts[today]||0) + 1;
          return {...u, lifetime: (u.lifetime||0) + 1, weekly: (u.weekKey===wk?u.weekly:0)+1, weekKey:wk, dayCounts};
        });
        gtmEvent('increment', { user_id: store.activeUserId || null, total: predicted, method:'tap' });
        if(predicted % BEAD_COUNT === 0){
          gtmEvent('complete_108', { user_id: store.activeUserId || null, rounds: Math.floor(predicted / BEAD_COUNT) });
        }
        spawnBurst(x,y);
        try{ navigator.vibrate?.(8); }catch{}
      }

      function handleDec(){
        const active = getActive(); if(!active) return;
        updateUser(store.activeUserId, u => {
          const today = fmtDate(new Date());
          const dayCounts = {...(u.dayCounts||{})};
          if(u.lifetime>0){
            if((dayCounts[today]||0)>0) dayCounts[today]-=1;
            return {...u, lifetime: Math.max(0,u.lifetime-1), weekly: Math.max(0,(u.weekly||0)-1), dayCounts};
          }
          return u;
        });
        gtmEvent('decrement', { user_id: store.activeUserId || null });
      }

      function resetToMultiple108(){
        const active = getActive(); if(!active) return;
        updateUser(store.activeUserId, u => {
          const diff = u.lifetime % BEAD_COUNT; if(diff===0) return u;
          return {...u, lifetime: u.lifetime - diff, weekly: Math.max(0,(u.weekly||0)-diff)};
        });
        gtmEvent('reset_to_multiple_108', { user_id: store.activeUserId || null });
      }

      function resetAllForActive(){
        const active = getActive(); if(!active) return;
        if(!confirm('Reset this user (clears lifetime, weekly & daily history)?')) return;
        updateUser(store.activeUserId, u => ({...u, lifetime:0, weekly:0, dayCounts:{}}));
        gtmEvent('reset_user', { user_id: store.activeUserId || null });
      }

      // profile functions
      function makeId(){ return Math.random().toString(36).slice(2,9); }

      function createProfile(){
        const nm = nameInput.value.trim();
        const ct = cityInput.value.trim();
        if(!nm) return alert('Please enter your name');
        const id = makeId(); const wk = weekKeyOf(new Date());
        const u = { id, name: nm, city: ct, createdAt: Date.now(), lifetime:0, weekly:0, weekKey: wk, dayCounts: {} };
        const s = {...store, users: {...store.users, [id]: u}, activeUserId: id };
        window.__rjc_activeUser = id;
        saveAndSet(s);
        nameInput.value = ''; cityInput.value = '';
        gtmEvent('create_profile', { user_id: id, name_length: nm.length });
      }

      function switchUser(id){
        const s = {...store, activeUserId: id};
        window.__rjc_activeUser = id;
        saveAndSet(s);
        gtmEvent('switch_user', { user_id: id });
      }

      function deleteUser(id){
        if(!confirm('Delete this user? Data removed from this device.')) return;
        const s = {...store, users:{...store.users}}; delete s.users[id];
        if(s.activeUserId === id) s.activeUserId = Object.keys(s.users)[0] || null;
        window.__rjc_activeUser = s.activeUserId || null;
        saveAndSet(s);
        gtmEvent('delete_profile', { user_id: id });
      }

      // render leaderboard with avatars and medals
      function colorForName(name){
        let code = 0; for(let i=0;i<name.length;i++) code = (code<<5)-code + name.charCodeAt(i);
        const hue = Math.abs(code) % 360;
        return `linear-gradient(135deg,hsl(${hue} 70% 50%), hsl(${(hue+40)%360} 70% 45%))`;
      }

      function renderLeaderboard(){
        const arr = Object.values(store.users || {});
        if(arr.length === 0){ leaderList.innerHTML = '<div style="color:rgba(255,255,255,0.8)">No users yet</div>'; return; }
        const sorted = arr.slice().sort((a,b)=>(b.weekly||0)-(a.weekly||0));
        leaderList.innerHTML = '';
        sorted.forEach((u,i)=>{
          const row = document.createElement('div'); row.className='leader-row';
          const avatar = document.createElement('div'); avatar.className='avatar'; avatar.style.background = colorForName(u.name); avatar.textContent = u.name.slice(0,1).toUpperCase();
          const nameDiv = document.createElement('div'); nameDiv.className='u-name'; nameDiv.textContent = u.name + (u.city? ` ‚Ä¢ ${u.city}` : '');
          const score = document.createElement('div'); score.textContent = (u.weekly||0);
          const meta = document.createElement('div'); meta.style.display='flex'; meta.style.alignItems='center';
          if(i===0){ const m = document.createElement('div'); m.className='medal'; m.textContent='ü•á'; meta.appendChild(m); }
          else if(i===1){ const m = document.createElement('div'); m.className='medal'; m.textContent='ü•à'; meta.appendChild(m); }
          else if(i===2){ const m = document.createElement('div'); m.className='medal'; m.textContent='ü•â'; meta.appendChild(m); }
          row.appendChild(avatar); row.appendChild(nameDiv); row.appendChild(meta); row.appendChild(score);
          leaderList.appendChild(row);
        });
      }

      function renderHistory(){
        const active = getActive();
        if(!active){ historyArea.textContent = 'No history yet ‚Äî create a profile to begin.'; return; }
        const entries = Object.entries(active.dayCounts || {}).sort((a,b)=> b[0].localeCompare(a[0])).slice(0,14);
        if(entries.length === 0){ historyArea.textContent = 'No history yet ‚Äî tap to begin.'; return; }
        const table = document.createElement('table'); table.className='table';
        const thead = document.createElement('thead'); thead.innerHTML = '<tr><th>Date</th><th>Count</th></tr>';
        const tbody = document.createElement('tbody');
        entries.forEach(([d,c])=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${d}</td><td>${c}</td>`;
          tbody.appendChild(tr);
        });
        table.appendChild(thead); table.appendChild(tbody);
        historyArea.innerHTML = ''; historyArea.appendChild(table);
      }

      // attach handlers
      // tapping on ring viewport -> increment
      document.getElementById('ring-viewport').addEventListener('pointerdown', (e)=>{
        // ignore if pointer on controls inside
        handleInc(e.clientX, e.clientY);
      });

      btnTap.addEventListener('click', ()=> handleInc(window.innerWidth/2, window.innerHeight/2));
      btnDec.addEventListener('click', handleDec);
      btnReset108.addEventListener('click', resetToMultiple108);
      btnResetUser.addEventListener('click', resetAllForActive);
      createBtn.addEventListener('click', createProfile);

      // create/select UI from store initially
      function renderProfileArea(){
        const area = document.getElementById('profile-area');
        area.innerHTML = '';
        const users = Object.values(store.users || {});
        if(users.length === 0){
          // show create form (already in DOM), nothing to change
          area.appendChild(document.getElementById('profile-form'));
        } else {
          // build selector
          const div = document.createElement('div'); div.style.display='flex'; div.style.flexDirection='column'; div.style.gap='8px';
          const selWrap = document.createElement('div'); selWrap.style.display='flex'; selWrap.style.gap='8px';
          const sel = document.createElement('select'); sel.style.padding='8px'; sel.style.borderRadius='10px'; sel.style.minWidth='140px';
          const blank = document.createElement('option'); blank.value=''; blank.textContent='Select user'; sel.appendChild(blank);
          users.forEach(u => { const o = document.createElement('option'); o.value = u.id; o.textContent = u.name + (u.city? ` ‚Ä¢ ${u.city}` : ''); sel.appendChild(o); });
          sel.value = store.activeUserId || '';
          sel.addEventListener('change', (e)=>{ if(e.target.value) switchUser(e.target.value); });
          selWrap.appendChild(sel);

          const delBtn = document.createElement('button'); delBtn.className='btn secondary'; delBtn.textContent='Delete';
          delBtn.addEventListener('click', ()=> { if(sel.value) deleteUser(sel.value); });
          selWrap.appendChild(delBtn);
          div.appendChild(selWrap);
          area.appendChild(div);
        }
      }

      // share actions
      shareBtn.addEventListener('click', async ()=>{
        const page = location.href;
        const text = 'I am using NaamJaa ‚Äî Radha Naam Jaap Counter. Try it: ';
        try {
          if(navigator.share){
            await navigator.share({title: document.title, text: text, url: page});
          } else {
            prompt('Copy & share:', page);
          }
          gtmEvent('share', { method: navigator.share ? 'native' : 'copy' });
        } catch(e){}
      });

      shareWhats.addEventListener('click', ()=>{
        const text = encodeURIComponent('‡§Æ‡•à‡§Ç‡§®‡•á ‡§Ü‡§ú ‡§Ö‡§™‡§®‡§æ ‡§ú‡§æ‡§™ ‡§ï‡§ø‡§Ø‡§æ - try NaamJaa Radha Naam Jaap Counter: ' + location.href);
        const wa = `https://wa.me/?text=${text}`;
        window.open(wa, '_blank');
        gtmEvent('share', { method: 'whatsapp' });
      });

      // UPI click tracking
      upiBtn.addEventListener('click', ()=> gtmEvent('donate_click', { user_id: window.__rjc_activeUser || null }));

      // keyboard support
      window.addEventListener('keydown', (e)=>{
        if(e.key === ' ' || e.key === 'Enter'){ e.preventDefault(); handleInc(window.innerWidth/2, window.innerHeight/2); }
        if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'z'){ handleDec(); }
      });

      // on load, populate UI
      (function init(){
        // ensure week rollover for existing users
        const now = new Date(); const wk = weekKeyOf(now);
        let changed = false;
        const s = {...store, users:{...store.users}};
        for(const [id,u] of Object.entries(s.users)){
          if(u.weekKey !== wk){ s.users[id] = {...u, weekKey: wk, weekly:0}; changed = true; }
        }
        if(changed){ store = s; saveStore(store); }

        renderProfileArea();
        updateUI();
        // set global active id var for UPI
        window.__rjc_activeUser = store.activeUserId || null;

        // ensure beads are present (for smaller viewports)
        createBeads();
        updateUI();
      })();

      // expose store for debugging in console
      window.__rjc_store = store;
    </script>
  </body>
</html>
