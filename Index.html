<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Radha Jaap Counter — Tap Anywhere to Count Mantras</title>
    <meta name="description" content="Mobile-friendly Radha Jaap counter. Tap anywhere to add 1 mantra, track rounds (108), create your profile (name & city), see daily history and weekly leaderboard." />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <link rel="canonical" href="https://example.com/radha-jaap/" />

    <!-- PWA / Theming -->
    <meta name="theme-color" content="#f3722c" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" href="/icons/icon-192.png" sizes="192x192" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Radha Jaap Counter">
    <meta property="og:description" content="Tap anywhere to count mantras. Profiles, daily history, and weekly leaderboard.">
    <meta property="og:url" content="https://example.com/radha-jaap/">
    <meta property="og:image" content="https://example.com/og/radha-jaap-1200x630.png">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Radha Jaap Counter">
    <meta name="twitter:description" content="Mobile-friendly counter with 108-round ring and weekly leaderboard.">
    <meta name="twitter:image" content="https://example.com/og/radha-jaap-1200x630.png">

    <!-- Preconnect for faster CDN fetch -->
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="dns-prefetch" href="//unpkg.com">

    <!-- React + Babel via CDN (Note: for production, remove Babel and ship prebuilt JS) -->
    <script defer crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script defer crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script defer crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      :root{
        --bg-start:#f9c74f; --bg-end:#f3722c; --fg:#2d1b00; --title:#f94144; --hint:#fef9c3; --ring-bg:rgba(255,255,255,.3);
        --pad:16px;
        --safe-top: max(var(--pad), env(safe-area-inset-top));
        --safe-right: max(var(--pad), env(safe-area-inset-right));
        --safe-bottom: max(var(--pad), env(safe-area-inset-bottom));
        --safe-left: max(var(--pad), env(safe-area-inset-left));
        --focus: #1f2937;
      }
      *{ box-sizing:border-box; }
      html,body{ height:100%; margin:0; }
      body{
        font-family:"Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background: radial-gradient(circle at top, var(--bg-start), var(--bg-end));
        color:var(--fg);
        user-select:none;
        -webkit-tap-highlight-color: transparent;
      }
      a:focus, button:focus, input:focus, select:focus{ outline:2px solid var(--focus); outline-offset:2px; }

      .screen{
        min-height:100dvh; width:100%;
        display:flex; align-items:center; justify-content:center;
        overflow:hidden;
        padding: var(--safe-top) var(--safe-right) var(--safe-bottom) var(--safe-left);
        position:relative;
        touch-action: manipulation;
      }
      .wrap{
        display:flex; flex-direction:column; align-items:center; gap:16px;
        max-width:720px; width:100%;
      }
      .title{
        text-align:center; margin:0; font-weight:900;
        font-size: clamp(32px, 8vw, 64px);
        letter-spacing:1px; color:var(--title);
        text-shadow:0 2px 10px rgba(0,0,0,.15);
      }
      .hint{
        text-align:center; margin-top:6px; color:var(--hint);
        font-size: clamp(14px, 3.5vw, 18px); opacity:.95;
      }
      .stats{ text-align:center; line-height:1.25; }
      .big{ font-size: clamp(28px, 9vw, 56px); font-weight:800; color:#fff7e0; }

      .soft-card{
        background: rgba(255,255,255,.15);
        backdrop-filter: blur(8px);
        border:1px solid rgba(255,255,255,.3);
        border-radius:20px;
        padding: 14px 18px;
        box-shadow:0 10px 24px rgba(0,0,0,.15);
        color:var(--hint);
        width:min(92vw, 560px);
      }

      .controls{
        display:flex; gap:10px; flex-wrap:wrap; justify-content:center;
        width:min(92vw, 560px);
      }
      button{
        appearance:none; border:none; border-radius:999px;
        padding:14px 20px; min-height:52px;
        font-weight:800; font-size: clamp(14px, 4vw, 16px);
        cursor:pointer;
        background: rgba(255,255,255,.9); color:var(--fg);
        box-shadow:0 8px 18px rgba(0,0,0,.15);
        transition: transform .15s ease, filter .15s ease;
      }
      @media (hover:hover){ button:hover{ filter:brightness(1.05); } }
      button:active{ transform: translateY(1px); }
      .footer{ font-size:12px; opacity:.85; margin-top:6px; color:#fffde8 }

      .ring-wrap{
        width: min(84vw, 420px);
        aspect-ratio: 1 / 1;
        display:grid; place-items:center;
      }
      .ring-wrap svg{ width:100%; height:100%; display:block; }

      .bursts{ position:fixed; inset:0; pointer-events:none; z-index:10; overflow:hidden; }
      .burst{
        position:absolute; left:0; top:0;
        transform: translate(-50%, -50%) scale(.85);
        font-weight:900; font-size: clamp(36px, 10vw, 120px); line-height:1;
        color:#fff6dc;
        text-shadow: 0 0 8px rgba(255,244,200,.9), 0 0 22px rgba(249,137,30,.7), 0 0 46px rgba(249,65,68,.55);
        opacity:0; animation: burst 900ms ease-out forwards;
        will-change: transform, opacity;
      }
      @keyframes burst{
        0%{opacity:1; transform:translate(-50%,-50%) scale(.9);}
        70%{opacity:1; transform:translate(-50%,-50%) scale(1.08);}
        100%{opacity:0; transform:translate(-50%,-50%) scale(1.22);}
      }
      @media (prefers-reduced-motion: reduce){
        .burst{ animation-duration: 300ms; }
        button{ transition: none; }
      }

      .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center; }
      .input{
        background: rgba(255,255,255,.92);
        border:1px solid rgba(0,0,0,.08);
        border-radius:14px;
        padding:12px 14px; min-height:48px;
        font-size:16px; outline:none;
        box-shadow:0 6px 14px rgba(0,0,0,.08) inset;
      }
      .table{
        width:100%; border-collapse:separate; border-spacing:0 8px; color:#fffef4;
        font-size:14px;
      }
      .table th{ text-align:left; opacity:.9; }
      .table td, .table th{ padding:8px 10px; }
      .pill{
        display:inline-block; background:rgba(255,255,255,.18); padding:4px 10px; border-radius:999px; font-weight:700;
      }

      /* Floating UPI button */
      .upi-fab{
        position:fixed; right:16px;
        bottom: calc(16px + env(safe-area-inset-bottom));
        z-index:999;
        background:#ffffffcc; color:#2d1b00; border-radius:999px;
        padding:12px 16px; font-weight:800; text-decoration:none;
        box-shadow:0 10px 24px rgba(0,0,0,.18);
        backdrop-filter: blur(6px);
      }
      .upi-fab:active{ transform:translateY(1px) }
      .visually-hidden{ position:absolute!important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; }
    </style>

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Radha Jaap Counter",
      "applicationCategory": "UtilityApplication",
      "operatingSystem": "Web",
      "url": "https://example.com/radha-jaap/",
      "description": "Tap anywhere to add 1 mantra, track 108-bead rounds, profiles with name & city, daily history, and weekly leaderboard.",
      "inLanguage": "en",
      "offers": { "@type": "Offer", "price": "0", "priceCurrency": "INR" },
      "publisher": {
        "@type": "Organization",
        "name": "Radha Jaap",
        "url": "https://example.com/"
      }
    }
    </script>
  </head>
  <body>
    <div id="bursts" class="bursts" aria-hidden="true"></div>

    <main id="root" role="main" aria-label="Radha Jaap Counter App">
      <noscript>
        <div style="max-width:720px;margin:24px auto;padding:16px;background:#fff3;border-radius:12px">
          <h1>Radha Jaap Counter</h1>
          <p>This app needs JavaScript enabled. Tap anywhere to add mantras, track 108-bead rounds, and see your weekly leaderboard.</p>
        </div>
      </noscript>
    </main>

    <script type="text/babel">
      const { useEffect, useMemo, useState } = React;
      const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
      const fmtDate = (d) => d.toISOString().slice(0,10);
      const weekKeyOf = (date) => {
        const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        const dayNum = (d.getUTCDay() + 6) % 7; d.setUTCDate(d.getUTCDate() - dayNum + 3);
        const firstThu = new Date(Date.UTC(d.getUTCFullYear(),0,4));
        const wk = 1 + Math.round((d - firstThu) / 604800000);
        const yr = d.getUTCFullYear(); return `${yr}-${String(wk).padStart(2,'0')}`;
      };
      const LS_KEY = "rjc_store_v2";
      const loadStore = () => { try{ return JSON.parse(localStorage.getItem(LS_KEY)) ?? {}; }catch{ return {}; } };
      const saveStore = (s) => localStorage.setItem(LS_KEY, JSON.stringify(s));

      function App(){
        const [size, setSize] = useState(() => clamp(Math.floor(window.innerWidth * 0.84), 220, 420));
        useEffect(() => {
          let raf=0; const onResize = () => { cancelAnimationFrame(raf); raf = requestAnimationFrame(()=> setSize(clamp(Math.floor(window.innerWidth*0.84), 220, 420))); };
          window.addEventListener("resize", onResize, {passive:true}); window.addEventListener("orientationchange", onResize);
          return () => { cancelAnimationFrame(raf); window.removeEventListener("resize", onResize); window.removeEventListener("orientationchange", onResize); };
        }, []);

        const [store, setStore] = useState(() => {
          const s = loadStore(); if(!s.users){ s.users = {}; } if(!s.activeUserId){ s.activeUserId = null; } return s;
        });
        const active = store.activeUserId ? store.users?.[store.activeUserId] : null;

        // weekly rollover
        useEffect(() => {
          const now = new Date(); const wk = weekKeyOf(now);
          const s = {...store, users:{...store.users}}; let changed=false;
          for(const [uid,u] of Object.entries(s.users)){
            if(u.weekKey !== wk){ s.users[uid] = {...u, weekKey:wk, weekly:0}; changed = true; }
          }
          if(changed){ setStore(s); saveStore(s); }
          // eslint-disable-next-line
        }, []);

        const count = active?.lifetime ?? 0;
        const within108 = count % 108;
        const bead = within108 + 1;
        const rounds = Math.floor(count / 108);

        const stroke = 20; const r = (size - stroke) / 2; const C = 2 * Math.PI * r;
        const dashOffset = C * (1 - within108 / 108);

        const spawnBurst = (x, y) => {
          const layer = document.getElementById("bursts"); if(!layer) return;
          const el = document.createElement("span"); el.className="burst"; el.textContent="राधा";
          el.style.left = x+"px"; el.style.top = y+"px"; layer.appendChild(el);
          el.addEventListener("animationend", ()=> el.remove(), {once:true});
        };
        const vibrate = (ms=10)=>{ try{ navigator.vibrate?.(ms);}catch{} };

        const updateUser = (uid, mutator) => {
          setStore(prev => {
            const s = {...prev, users:{...prev.users}}; const u = s.users[uid]; if(!u) return prev;
            const newU = mutator(u); s.users[uid] = newU; saveStore(s); return s;
          });
        };
        const handleInc = (x, y) => {
          if(!active) return;
          updateUser(store.activeUserId, (u) => {
            const now = new Date(); const wk = weekKeyOf(now); const today = fmtDate(now);
            const dayCounts = {...(u.dayCounts||{})}; dayCounts[today] = (dayCounts[today]||0)+1;
            return {...u, lifetime:u.lifetime+1, weekly:(u.weekKey===wk?u.weekly:0)+1, weekKey:wk, dayCounts};
          });
          vibrate(8); spawnBurst(x,y);
        };
        const handleDec = () => {
          if(!active) return;
          updateUser(store.activeUserId, (u) => {
            const today = fmtDate(new Date()); const dayCounts = {...(u.dayCounts||{})};
            if(u.lifetime>0){ if((dayCounts[today]||0)>0) dayCounts[today]-=1; return {...u, lifetime:u.lifetime-1, weekly:Math.max(0,u.weekly-1), dayCounts}; }
            return u;
          });
          vibrate(6);
        };
        const resetToMultiple108 = () => {
          if(!active) return;
          updateUser(store.activeUserId, (u) => {
            const diff = u.lifetime % 108; if(diff===0) return u;
            return {...u, lifetime:u.lifetime-diff, weekly:Math.max(0,(u.weekly||0)-diff)};
          });
        };
        const resetAllForActive = () => {
          if(!active) return;
          if(confirm("Reset this user's counts? (lifetime, weekly & day history)")){
            updateUser(store.activeUserId, (u)=> ({...u, lifetime:0, weekly:0, dayCounts:{}}));
          }
        };

        const onScreenPointerDown = (e) => {
          const x = (e.clientX ?? e?.touches?.[0]?.clientX ?? window.innerWidth/2);
          const y = (e.clientY ?? e?.touches?.[0]?.clientY ?? window.innerHeight/2);
          handleInc(x, y);
        };
        const stop = (e)=> e.stopPropagation();

        const [name, setName] = useState("");
        const [city, setCity] = useState("");
        const makeId = () => Math.random().toString(36).slice(2,10);

        const addUser = () => {
          const nm = name.trim(); const ct = city.trim();
          if(!nm) return alert("Please enter your name");
          const id = makeId(); const wk = weekKeyOf(new Date());
          const newUser = { id, name:nm, city:ct, createdAt: Date.now(), lifetime:0, weekly:0, weekKey:wk, dayCounts:{} };
          const s = {...store, users:{...store.users, [id]:newUser}, activeUserId:id};
          setStore(s); saveStore(s); setName(""); setCity("");
        };
        const switchUser = (id) => { const s = {...store, activeUserId:id}; setStore(s); saveStore(s); };
        const deleteUser = (id) => {
          if(!confirm("Delete this user? Data on this device will be removed.")) return;
          const s = {...store, users:{...store.users}}; delete s.users[id];
          if(s.activeUserId===id) s.activeUserId = Object.keys(s.users)[0] || null;
          setStore(s); saveStore(s);
        };

        const usersArr = useMemo(()=> Object.values(store.users||{}), [store.users]);
        const weeklyBoard = useMemo(()=> [...usersArr].sort((a,b)=>(b.weekly||0)-(a.weekly||0)), [usersArr]);
        const dayRows = useMemo(()=> active?.dayCounts ? Object.entries(active.dayCounts).sort((a,b)=> a[0]<b[0]?1:-1).slice(0,14) : [], [active]);

        useEffect(() => {
          const onKey = (e) => {
            if (e.key === " " || e.key === "Enter") { e.preventDefault(); handleInc(window.innerWidth/2, window.innerHeight/2); }
            if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === "z") { handleDec(); }
          };
          window.addEventListener("keydown", onKey); return () => window.removeEventListener("keydown", onKey);
        }, [active]);

        const noUsers = (usersArr.length===0);

        return (
          <div className="screen" onPointerDown={onScreenPointerDown}>
            <section className="wrap" aria-label="Counter and Controls">
              <header style={{textAlign:"center"}}>
                <h1 className="title" aria-label="Radha">राधा</h1>
                <p className="hint">Kahin bhi tap karo — 1 mantra add hoga</p>
              </header>

              <section className="soft-card" onPointerDown={stop} aria-label="Profile">
                {noUsers ? (
                  <>
                    <div className="row" role="group" aria-label="Create profile">
                      <label className="visually-hidden" htmlFor="name">Name</label>
                      <input id="name" className="input" autoComplete="name" placeholder="Name" value={name} onChange={e=>setName(e.target.value)} />
                      <label className="visually-hidden" htmlFor="city">City</label>
                      <input id="city" className="input" autoComplete="address-level2" placeholder="City" value={city} onChange={e=>setCity(e.target.value)} />
                      <button onPointerDown={stop} onClick={addUser}>Create Profile</button>
                    </div>
                    <div className="footer">Har device par alag profiles save hoti hain (offline).</div>
                  </>
                ) : (
                  <>
                    <div className="row" style={{justifyContent:"space-between"}}>
                      <div className="row" style={{justifyContent:"flex-start"}}>
                        <span className="pill" aria-hidden="true">Active:</span>
                        <label className="visually-hidden" htmlFor="activeUser">Active user</label>
                        <select id="activeUser" className="input" value={store.activeUserId||""} onChange={e=>switchUser(e.target.value)} style={{minWidth:200}}>
                          {usersArr.map(u=>(
                            <option key={u.id} value={u.id}>{u.name}{u.city?` • ${u.city}`:""}</option>
                          ))}
                        </select>
                      </div>
                      {active && <button onPointerDown={stop} onClick={()=>deleteUser(active.id)} aria-label="Delete active user">Delete</button>}
                    </div>
                    {!active && <div className="footer">Please select a user above.</div>}
                  </>
                )}
              </section>

              <div className="ring-wrap" aria-hidden="true">
                <svg viewBox={`0 0 ${size} ${size}`}>
                  <circle cx={size/2} cy={size/2} r={r} stroke="var(--ring-bg)" strokeWidth={stroke} fill="none" />
                  <circle
                    cx={size/2}
                    cy={size/2}
                    r={r}
                    stroke="url(#gradient)"
                    strokeWidth={stroke}
                    fill="none"
                    strokeDasharray={C}
                    strokeDashoffset={dashOffset}
                    transform={`rotate(-90 ${size/2} ${size/2})`}
                    strokeLinecap="round"
                  />
                  <defs>
                    <linearGradient id="gradient" x1="0" y1="0" x2="1" y2="1">
                      <stop offset="0%" stopColor="#f8961e" />
                      <stop offset="100%" stopColor="#f94144" />
                    </linearGradient>
                  </defs>
                </svg>
              </div>

              <section className="stats soft-card" aria-live="polite">
                {active ? (
                  <>
                    <div className="big" aria-label={`Bead ${bead} of 108`}>{bead} / 108</div>
                    <div>Round: {rounds}</div>
                    <div>Total: {active.lifetime}</div>
                    <div>This Week: {active.weekly} <span className="footer">Auto reset every Monday</span></div>
                  </>
                ) : (<div>Please create/select a user to start.</div>)}
              </section>

              <div className="controls" onPointerDown={e=>e.stopPropagation()} role="group" aria-label="Controls">
                <button onClick={handleDec} aria-label="Decrement by 1">-1</button>
                <button onClick={resetToMultiple108}>Reset to multiple of 108</button>
                <button onClick={resetAllForActive}>Reset User</button>
              </div>

              {active && (
                <section className="soft-card" onPointerDown={e=>e.stopPropagation()} aria-label="History (Last 14 days)">
                  <div className="row" style={{justifyContent:"space-between"}}>
                    <strong>Last 14 days</strong>
                    <span className="pill">{active.name}{active.city?` • ${active.city}`:""}</span>
                  </div>
                  {Object.keys(active.dayCounts||{}).length ? (
                    <table className="table" role="table" aria-label="Daily history">
                      <thead><tr><th scope="col">Date</th><th scope="col">Count</th></tr></thead>
                      <tbody>
                        {Object.entries(active.dayCounts).sort((a,b)=> a[0]<b[0]?1:-1).slice(0,14).map(([d,c])=>(
                          <tr key={d}><td>{d}</td><td>{c}</td></tr>
                        ))}
                      </tbody>
                    </table>
                  ) : <div className="footer">No history yet — tap to begin.</div>}
                </section>
              )}

              {Object.values(store.users||{}).length>1 && (
                <section className="soft-card" onPointerDown={e=>e.stopPropagation()} aria-label="Weekly leaderboard (this device)">
                  <div className="row" style={{justifyContent:"space-between"}}>
                    <strong>Weekly Leaderboard</strong>
                    <span className="pill">{weekKeyOf(new Date())}</span>
                  </div>
                  <table className="table" role="table">
                    <thead><tr><th>#</th><th>User</th><th>City</th><th>Jaap (week)</th></tr></thead>
                    <tbody>
                      {[...Object.values(store.users)].sort((a,b)=>(b.weekly||0)-(a.weekly||0)).map((u,i)=>(
                        <tr key={u.id}><td>{i+1}</td><td>{u.name}</td><td>{u.city||"-"}</td><td>{u.weekly||0}</td></tr>
                      ))}
                    </tbody>
                  </table>
                  <div className="footer">Note: Ye leaderboard sirf is device par stored users ke liye hai (global nahi).</div>
                </section>
              )}

              <p className="footer">Space/Enter = +1 • Ctrl/⌘Z = -1 • Haptics on mobile</p>
            </section>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>

    <!-- UPI support button -->
    <a
      class="upi-fab"
      href="upi://pay?pa=ankitgupta1181-5@oksbi&pn=Radha%20Jaap%20Counter&tn=Dhanyavaad%20🙏&cu=INR"
      title="Support via UPI"
      aria-label="Support via UPI"
      rel="nofollow"
    >❤️ UPI</a>

    <!-- Optional: register SW when you add /sw.js -->
    <script>
      if ('serviceWorker' in navigator) {
        // navigator.serviceWorker.register('/sw.js'); // uncomment after you add the file
      }
    </script>
  </body>
</html>
