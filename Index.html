<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Radha Jaap Counter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- React + Babel via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      :root{
        --bg-start:#f9c74f; --bg-end:#f3722c; --fg:#2d1b00; --title:#f94144; --hint:#fef9c3; --ring-bg:rgba(255,255,255,.3);
        --pad:16px;
        --safe-top: max(var(--pad), env(safe-area-inset-top));
        --safe-right: max(var(--pad), env(safe-area-inset-right));
        --safe-bottom: max(var(--pad), env(safe-area-inset-bottom));
        --safe-left: max(var(--pad), env(safe-area-inset-left));
      }
      *{ box-sizing:border-box; }
      html,body{ height:100%; margin:0; }
      body{
        font-family:"Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background: radial-gradient(circle at top, var(--bg-start), var(--bg-end));
        color:var(--fg);
        user-select:none;
        -webkit-tap-highlight-color: transparent;
      }
      .screen{
        min-height:100vh; width:100%;
        display:flex; align-items:center; justify-content:center;
        overflow:hidden;
        padding: calc(var(--safe-top)) calc(var(--safe-right)) calc(var(--safe-bottom)) calc(var(--safe-left));
        position:relative;
        /* helps avoid double-tap zoom and delays */
        touch-action: manipulation;
      }
      .wrap{
        display:flex; flex-direction:column; align-items:center; gap:16px;
        max-width:720px; width:100%;
      }
      .title{
        text-align:center; margin:0; font-weight:900;
        font-size: clamp(32px, 8vw, 64px);
        letter-spacing:1px; color:var(--title);
        text-shadow:0 2px 10px rgba(0,0,0,.15);
      }
      .hint{
        text-align:center; margin-top:6px; color:var(--hint);
        font-size: clamp(14px, 3.5vw, 18px); opacity:.95;
      }
      .stats{ text-align:center; line-height:1.25; }
      .big{ font-size: clamp(28px, 9vw, 56px); font-weight:800; color:#fff7e0; }

      .soft-card{
        background: rgba(255,255,255,.15);
        backdrop-filter: blur(8px);
        border:1px solid rgba(255,255,255,.3);
        border-radius:20px;
        padding: 14px 18px;
        box-shadow:0 10px 24px rgba(0,0,0,.15);
        color:var(--hint);
        width:min(92vw, 560px);
      }

      .controls{
        display:flex; gap:10px; flex-wrap:wrap; justify-content:center;
        width:min(92vw, 560px);
      }
      button{
        appearance:none; border:none; border-radius:999px;
        padding:12px 18px; min-height:48px; /* ≥48px touch target */
        font-weight:800; font-size: clamp(14px, 4vw, 16px);
        cursor:pointer;
        background: rgba(255,255,255,.85); color:var(--fg);
        box-shadow:0 8px 18px rgba(0,0,0,.15);
        transition: transform .15s ease, filter .15s ease;
      }
      @media (hover:hover){
        button:hover{ filter:brightness(1.05); }
      }
      button:active{ transform: translateY(1px); }
      .footer{ font-size:12px; opacity:.75; margin-top:6px; }

      /* Ring SVG wrapper to scale responsively */
      .ring-wrap{
        width: min(84vw, 420px);
        /* keep it square without JS layout thrash */
        aspect-ratio: 1 / 1;
        display:grid; place-items:center;
      }
      .ring-wrap svg{ width:100%; height:100%; display:block; }

      /* Bursts layer */
      .bursts{
        position:fixed; inset:0; pointer-events:none; z-index:10; overflow:hidden;
      }
      .burst{
        position:absolute; left:0; top:0;
        transform: translate(-50%, -50%) scale(.85);
        font-weight:900; font-size: clamp(36px, 10vw, 120px); line-height:1;
        color:#fff6dc;
        text-shadow: 0 0 8px rgba(255,244,200,.9), 0 0 22px rgba(249,137,30,.7), 0 0 46px rgba(249,65,68,.55);
        opacity:0; animation: burst 900ms ease-out forwards;
        will-change: transform, opacity;
      }
      @keyframes burst{
        0%{opacity:1; transform:translate(-50%,-50%) scale(.9);}
        70%{opacity:1; transform:translate(-50%,-50%) scale(1.08);}
        100%{opacity:0; transform:translate(-50%,-50%) scale(1.22);}
      }

      /* Reduced motion */
      @media (prefers-reduced-motion: reduce){
        .burst{ animation-duration: 300ms; }
        button{ transition: none; }
      }
    </style>

    <!-- Floating UPI button -->
    <style>
      .upi-fab{
        position:fixed; right:16px;
        bottom: calc(16px + env(safe-area-inset-bottom));
        z-index:999;
        background:#ffffffcc; color:#2d1b00; border-radius:999px;
        padding:12px 16px; font-weight:800; text-decoration:none;
        box-shadow:0 10px 24px rgba(0,0,0,.18);
        backdrop-filter: blur(6px);
      }
      .upi-fab:active{ transform:translateY(1px) }
    </style>
  </head>
  <body>
    <div id="bursts" class="bursts" aria-hidden="true"></div>
    <div id="root"></div>

    <script type="text/babel">
      const { useEffect, useMemo, useState } = React;

      // helper: clamp utility
      const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

      function RadhaJaapCounter(){
        const [count, setCount] = useState(() => {
          const saved = localStorage.getItem("radha_jaap_count");
          return saved ? parseInt(saved, 10) : 0;
        });

        // responsive ring size (in px) based on viewport width
        const [size, setSize] = useState(() => clamp(Math.floor(window.innerWidth * 0.84), 220, 420));
        useEffect(() => {
          let raf = 0;
          const onResize = () => {
            cancelAnimationFrame(raf);
            raf = requestAnimationFrame(() => {
              setSize(clamp(Math.floor(window.innerWidth * 0.84), 220, 420));
            });
          };
          window.addEventListener("resize", onResize);
          window.addEventListener("orientationchange", onResize);
          return () => {
            cancelAnimationFrame(raf);
            window.removeEventListener("resize", onResize);
            window.removeEventListener("orientationchange", onResize);
          };
        }, []);

        useEffect(() => { localStorage.setItem("radha_jaap_count", String(count)); }, [count]);

        const within108 = count % 108;
        const bead = within108 + 1;
        const rounds = Math.floor(count / 108);

        // geometry derived from responsive size
        const stroke = 20;
        const r = (size - stroke) / 2;
        const C = 2 * Math.PI * r;
        const dashOffset = C * (1 - within108 / 108);

        const spawnBurst = (x, y) => {
          const layer = document.getElementById("bursts");
          if (!layer) return;
          const el = document.createElement("span");
          el.className = "burst";
          el.textContent = "राधा";
          el.style.left = x + "px";
          el.style.top = y + "px";
          layer.appendChild(el);
          el.addEventListener("animationend", () => el.remove(), { once:true });
        };

        // Unified pointer handler (avoids double-trigger on mobile)
        const handlePointerDown = (e) => {
          setCount(c => c + 1);
          const x = e.clientX ?? window.innerWidth/2;
          const y = e.clientY ?? window.innerHeight/2;
          spawnBurst(x, y);
        };

        const handleDecrement = e => { setCount(c => Math.max(0, c - 1)); };
        const handleReset108 = e => { setCount(c => c - (c % 108)); };
        const handleResetAll = e => { if (confirm("Reset all?")) setCount(0); };

        // Keyboard: Space/Enter = +1, Ctrl/⌘Z = -1 (center burst on +1)
        useEffect(() => {
          const onKey = (e) => {
            if (e.key === " " || e.key === "Enter") {
              e.preventDefault();
              setCount(c => c + 1);
              spawnBurst(window.innerWidth/2, window.innerHeight/2);
            }
            if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === "z") {
              setCount(c => Math.max(0, c - 1));
            }
          };
          window.addEventListener("keydown", onKey);
          return () => window.removeEventListener("keydown", onKey);
        }, []);

        return (
          <div
            className="screen"
            onPointerDown={handlePointerDown}
            role="application"
            aria-label="Radha Jaap Counter"
          >
            <main className="wrap">
              <header style={{textAlign:"center"}}>
                <h1 className="title">राधा</h1>
                <div className="hint">Tap anywhere to add 1 mantra</div>
              </header>

              <div className="ring-wrap" aria-hidden="true" onPointerDown={(e)=>e.stopPropagation()}>
                <svg viewBox={`0 0 ${size} ${size}`}>
                  <circle cx={size/2} cy={size/2} r={r} stroke="var(--ring-bg)" strokeWidth={stroke} fill="none" />
                  <circle
                    cx={size/2}
                    cy={size/2}
                    r={r}
                    stroke="url(#gradient)"
                    strokeWidth={stroke}
                    fill="none"
                    strokeDasharray={C}
                    strokeDashoffset={dashOffset}
                    transform={`rotate(-90 ${size/2} ${size/2})`}
                    strokeLinecap="round"
                  />
                  <defs>
                    <linearGradient id="gradient" x1="0" y1="0" x2="1" y2="1">
                      <stop offset="0%" stopColor="#f8961e" />
                      <stop offset="100%" stopColor="#f94144" />
                    </linearGradient>
                  </defs>
                </svg>
              </div>

              <section
                className="stats soft-card"
                onPointerDown={(e)=>e.stopPropagation()}
                aria-live="polite"
              >
                <div className="big">{bead} / 108</div>
                <div>Round: {rounds}</div>
                <div>Total: {count}</div>
                <div className="footer">Space/Enter = +1 • Ctrl/⌘Z = -1</div>
              </section>

              <div className="controls" onPointerDown={(e)=>e.stopPropagation()}>
                <button onClick={handleDecrement} aria-label="Decrement by 1">-1</button>
                <button onClick={handleReset108}>Reset to multiple of 108</button>
                <button onClick={handleResetAll}>Reset All</button>
              </div>
            </main>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<RadhaJaapCounter />);
    </script>

    <!-- UPI support button -->
    <a
      class="upi-fab"
      href="upi://pay?pa=ankitgupta1181-5@oksbi&pn=Radha%20Jaap%20Counter&tn=Dhanyavaad%20🙏&cu=INR"
      title="Support via UPI"
      aria-label="Support via UPI"
    >❤️ UPI</a>
  </body>
</html>
